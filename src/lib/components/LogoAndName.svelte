<script>
	import { onMount } from "svelte";
    import { saving } from "$lib/scripts/stores";
    import { goto } from "$app/navigation";

    let value = "введите название";
    let span;
    let showHeading = false;
    let showName = true;

    /**
     * @type {number}
     * @description id интервала, анимирующего строку статуса*/
    let interval;

    /**
     * @type {string}
     * @description отображает текст в строке индикации процесса сохранения*/
    let status = '';
    $: if($saving){
        let str = "Сохраняем...";
        let i = 3;
        interval = setInterval( () => {
            status = str.slice(0, str.length - i);
            if(i-- === 0) i = 3;
        }, 500);
    } else {
        status = "изменения сохранены";
        clearInterval(interval);
    }


    
    function handleUp(e){
        value = span.textContent;
    }


    onMount( () => {
        let urlString = window.location.toString();
        
        if(urlString.includes("redactor") || urlString.includes("anketa") ) showHeading = true;
        if(urlString.includes("projects")) {
            showHeading = true;
            showName = false;
        }
    });
</script>

<div class="container">

    <svg width="32" height="40" viewBox="0 0 32 40" fill="none" xmlns="http://www.w3.org/2000/svg" on:click={ () => goto("/projects")}>
        <path class="logo" fill-rule="evenodd" clip-rule="evenodd" d="M5.33359 27.1803C7.02062 28.0231 9.071 28.4444 11.4847 28.4444C13.2496 28.4444 14.8328 28.2074 16.2344 27.7333C17.6359 27.2593 18.8298 26.614 19.8161 25.7975C20.8023 24.9547 21.568 23.9802 22.113 22.8741C22.658 21.7679 22.9435 20.5695 22.9695 19.279C22.9954 19.042 22.9176 18.8444 22.7359 18.6864C22.5802 18.5284 22.3855 18.4494 22.1519 18.4494H18.4535C18.168 18.4494 17.9344 18.5152 17.7527 18.6469C17.571 18.7786 17.4412 19.0288 17.3634 19.3975C16.9481 21.1095 16.2344 22.2947 15.2222 22.9531C14.2099 23.5852 12.9512 23.9012 11.4458 23.9012C9.70688 23.9012 8.31833 23.414 7.28016 22.4395C6.24199 21.4387 5.68398 19.8058 5.60611 17.5407C5.52825 15.2757 5.52825 13.0634 5.60611 10.9037C5.68398 8.63868 6.24199 7.01893 7.28016 6.04444C8.31833 5.04362 9.70688 4.54321 11.4458 4.54321C12.9512 4.54321 14.2099 4.85926 15.2222 5.49136C16.2344 6.12346 16.9481 7.30864 17.3634 9.04691C17.4412 9.3893 17.571 9.63951 17.7527 9.79753C17.9344 9.92922 18.168 9.99506 18.4535 9.99506H22.1519C22.3855 9.99506 22.5802 9.91605 22.7359 9.75803C22.9176 9.6 22.9954 9.40247 22.9695 9.16543C22.9435 7.8749 22.658 6.67654 22.113 5.57037C21.568 4.4642 20.8023 3.50288 19.8161 2.68642C18.8298 1.84362 17.6359 1.18519 16.2344 0.711111C14.8328 0.237037 13.2496 0 11.4847 0C9.09696 0 7.05955 0.434568 5.37253 1.3037C3.71146 2.1465 2.42672 3.37119 1.51832 4.97778C0.635879 6.58436 0.142748 8.49383 0.0389312 10.7062C0.012977 11.8387 0 13.0239 0 14.2617C0 15.4996 0.012977 16.6584 0.0389312 17.7383C0.142748 19.977 0.635879 21.8996 1.51832 23.5062C2.40077 25.0864 3.67252 26.3111 5.33359 27.1803ZM26.6664 12.8198C24.9794 11.977 22.929 11.5556 20.5152 11.5556C18.7503 11.5556 17.1671 11.7926 15.7656 12.2667C14.3641 12.7407 13.1702 13.386 12.1839 14.2025C11.1977 15.0453 10.432 16.0198 9.88698 17.1259C9.34194 18.2321 9.05644 19.4305 9.03049 20.721C9.00453 20.958 9.08239 21.1556 9.26408 21.3136C9.4198 21.4716 9.61446 21.5506 9.84804 21.5506H13.5465C13.832 21.5506 14.0656 21.4848 14.2473 21.3531C14.429 21.2214 14.5587 20.9712 14.6366 20.6025C15.0519 18.8905 15.7656 17.7054 16.7778 17.0469C17.79 16.4148 19.0488 16.0988 20.5542 16.0988C22.2931 16.0988 23.6817 16.586 24.7198 17.5605C25.758 18.5613 26.316 20.1942 26.3939 22.4593C26.4717 24.7243 26.4717 26.9366 26.3939 29.0963C26.316 31.3613 25.758 32.9811 24.7198 33.9556C23.6817 34.9564 22.2931 35.4568 20.5542 35.4568C19.0488 35.4568 17.79 35.1407 16.7778 34.5086C15.7656 33.8765 15.0519 32.6914 14.6366 30.9531C14.5587 30.6107 14.429 30.3605 14.2473 30.2025C14.0656 30.0708 13.832 30.0049 13.5465 30.0049H9.84804C9.61446 30.0049 9.4198 30.0839 9.26407 30.242C9.08239 30.4 9.00453 30.5975 9.03049 30.8346C9.05644 32.1251 9.34194 33.3235 9.88697 34.4296C10.432 35.5358 11.1977 36.4971 12.1839 37.3136C13.1702 38.1564 14.3641 38.8148 15.7656 39.2889C17.1671 39.763 18.7503 40 20.5152 40C22.903 40 24.9404 39.5654 26.6275 38.6963C28.2885 37.8535 29.5733 36.6288 30.4817 35.0222C31.3641 33.4156 31.8572 31.5062 31.9611 29.2938C31.987 28.1613 32 26.9761 32 25.7383C32 24.5004 31.987 23.3416 31.9611 22.2617C31.8572 20.023 31.3641 18.1004 30.4817 16.4938C29.5992 14.9136 28.3275 13.6889 26.6664 12.8198Z"/>
    </svg>

    {#if showHeading}
        {#if showName}
        <div class="document_name">
            <span contenteditable="true" on:keyup={handleUp} bind:this={span} >{value}</span>
            <svg>
                <use href="/assets/icons/all.svg#pen"></use>
            </svg>
        </div>
        {/if}

        <span class="status">{status}</span>
    {/if}
        
</div>

<style>
    .container{
        background-color: transparent;
        display: flex;
        align-items: start;
        justify-content: space-between;
        gap: 1.25rem;
    }

    .container>svg{
        cursor: pointer;
    }
    
    .logo{
        fill: var(--gray-blue);
    }

    .document_name{
        display: flex;
        align-items: end;
        top: 0;
        gap: .5rem;
    }

    .document_name span{
        font-size: 1.125rem;
        line-height: 1.125rem;
        margin: 0;
        font-weight: 500;
        outline: none;
    }

    .document_name svg{
        width: 1rem;
        height: 1rem;
    }

    .status{
        font-size: .875rem;
        font-style: italic;
        color: var(--faded-gray-blue);
    }
</style>